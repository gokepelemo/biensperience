<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Primary SVG Icon -->
    <link rel="icon" type="image/svg+xml" href="/icon.svg?v=1.0" />
    <!-- Fallback PNG Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=1.0" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=1.0" />
    <link rel="shortcut icon" href="/favicon-32x32.png?v=1.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#6f42c1" />
    <meta
      name="description"
      content="A React app for travelers and adventurers alike."
    />
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icon-192x192.png?v=1.0" />
    <link rel="apple-touch-icon" sizes="192x192" href="/icon-192x192.png?v=1.0" />
    <link rel="apple-touch-icon" sizes="512x512" href="/icon-512x512.png?v=1.0" />
    <link rel="manifest" href="/manifest.json?v=1.0" />
    <title>Biensperience</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script>
      (function() {
        try {
          var raw = null;
          try { raw = localStorage.getItem('biensperience:preferences'); } catch (e) { raw = null; }
          var theme = null;
          if (raw) {
            try {
              var prefs = JSON.parse(raw) || {};
              if (prefs && prefs.theme) theme = prefs.theme;
            } catch (e) { theme = null; }
          }
          if (!theme) {
            // fallback: use system preference
            var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            theme = prefersDark ? 'dark' : 'light';
          }
          // resolve system-default to actual applied theme
          var applied = theme;
          if (theme === 'system-default') {
            try {
              var prefersDark2 = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
              applied = prefersDark2 ? 'dark' : 'light';
            } catch (e) { applied = 'light'; }
          }
          document.documentElement.setAttribute('data-theme', applied);
          // Set bootstrap theme attribute for components
          try { document.documentElement.setAttribute('data-bs-theme', applied); } catch (e) {}
        } catch (err) {
          // ignore
        }
      })();
    </script>
    <script>
      // CRITICAL: Preserve hash fragments ONLY for direct URL access (page load/refresh)
      // React Router doesn't handle hash fragments in URLs during navigation,
      // so we capture them here and store in localStorage for React to retrieve
      // This should NOT run for in-app navigation (HashLink handles that)
      (function() {
        try {
          var hash = window.location.hash || '';
          // Only preserve hash if:
          // 1. Hash exists and is a plan hash
          // 2. localStorage does NOT already have a pending hash (meaning this is a direct URL, not in-app navigation)
          if (hash && hash.startsWith('#plan-')) {
            var existing = localStorage.getItem('bien:pending_hash');
            if (!existing) {
              console.log('[Hash Preservation] Direct URL hash detected:', hash);
              // Store hash in localStorage so React can retrieve it after Router strips it
              var payload = JSON.stringify({
                hash: hash,
                originPath: window.location.pathname,
                storedAt: Date.now(),
                meta: { source: 'direct-url' }
              });
              localStorage.setItem('bien:pending_hash', payload);
              console.log('[Hash Preservation] Hash stored in localStorage for React to retrieve');
            } else {
              console.log('[Hash Preservation] Skipping - pending hash already exists (in-app navigation)');
            }
          }
        } catch (e) {
          console.error('[Hash Preservation] Failed to preserve hash:', e);
        }
      })();
    </script>
    <!-- Vite entry point -->
    <script type="module" src="/src/index.jsx"></script>
  </body>
</html>
