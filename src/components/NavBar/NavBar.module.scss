/**
 * NavBar Component Styles (SCSS Module)
 * Migrated from NavBar.css to NavBar.module.scss
 * Uses SASS variables and mixins for better maintainability
 */

@use '../../styles/scss/abstracts' as *;

/* ============================================
   NAVBAR BACKGROUND - Always Dark Exception
   ============================================
   The navbar is ALWAYS dark with light text, regardless of
   light/dark mode. This is the only exception to the theme system.
   ============================================ */

/* Always dark navbar background (both light and dark mode) */
.navbar {
  background: #1e1e1e !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  /* Base transition properties for smooth state changes */
  transition: box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
              transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  /* Prevent content jump when transitioning */
  min-height: 56px;

  /* Align all navbar items to text baseline for pixel-perfect alignment */
  :global(.container-fluid) {
    display: flex;
    align-items: baseline; /* Align all items to text baseline */
  }

  /* Ensure navbar-collapse also aligns to baseline */
  :global(.navbar-collapse) {
    align-items: baseline;
  }

  /* Ensure navbar-nav ul aligns items to baseline */
  :global(.navbar-nav) {
    align-items: baseline;
  }
}

/* Sticky navbar - optimized for smooth transitions */
.navbar.sticky {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: var(--z-index-fixed);
  box-shadow: var(--shadow-sm);
  /* GPU-accelerated transition for smooth appearance */
  animation: slideDown 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  /* Prevent layout thrashing during animation */
  will-change: transform, opacity;
  contain: layout style;
  /* Ensure consistent dimensions */
  height: auto;
  min-height: 56px;
}

@keyframes slideDown {
  from {
    transform: translate3d(0, -100%, 0);
    opacity: 0;
  }
  to {
    transform: translate3d(0, 0, 0);
    opacity: 1;
  }
}

/* Body padding for sticky navbar - use CSS transition for smoothness */
:global(body) {
  transition: padding-top 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

:global(body:has(.navbar.sticky)) {
  padding-top: 70px; /* Fixed value for layout stability */
}

.logo {
  margin: 0 $space-4 0 0;
  font-size: $font-size-2xl; /* Match experience card buttons */
  font-weight: $font-weight-normal; /* Lighter weight for better centering */
  padding: 0;
  line-height: $line-height-tight;
  @include flex-center;
  /* Use standardized button height for WCAG touch target (44px) */
  width: var(--btn-height-md);
  height: var(--btn-height-md);
  background: var(--gradient-primary);
  color: white;
  border: none;
  border-radius: var(--btn-radius-default);
  @include transition-all(var(--btn-transition));
  font-family: var(--font-family-base);

  &:hover {
    background: var(--gradient-primary);
    transform: scale(1.1);
  }
}

:global(nav) {
  font-weight: $font-weight-bold;
}

/* Navbar brand wrapper for dynamic text */
.navbarBrandWrapper {
  @include flex-start;
  align-items: baseline; /* Align brand to text baseline */
}

.brandText {
  @include transition-all($transition-normal);
  display: inline-block;
  color: white !important;
  font-weight: $font-weight-bold;
}

/* Mobile: Center brand, keep hamburger aligned right */
@include breakpoint-max(lg) {
  .navbar > :global(.container-fluid) {
    display: flex;
    flex-wrap: nowrap; /* Prevent hamburger from wrapping to new line */
    align-items: center; /* Center items vertically */
    justify-content: center; /* Center content horizontally */
    position: relative; /* For absolute positioning of toggler */
  }

  .navbarBrandWrapper {
    flex: 0 1 auto; /* Don't expand, allow natural width */
    min-width: 0;
    margin: 0 auto; /* Center the brand wrapper */
    text-align: center;
    /* Account for hamburger on the right */
    padding-right: calc(44px + #{$space-3}); /* Hamburger width + spacing */
    padding-left: calc(44px + #{$space-3}); /* Balance on left for true centering */
  }

  :global(.navbar-brand) {
    max-width: 100%; /* Prevent overflow */
    justify-content: center; /* Center logo and text within brand */
  }

  .brandText {
    white-space: nowrap; /* Prevent text from wrapping */
    overflow: hidden; /* Hide overflow text */
    text-overflow: ellipsis; /* Show ellipsis for long text */
  }

  :global(.navbar-toggler) {
    flex-shrink: 0; /* Prevent hamburger from shrinking */
    /* Strongly enforce right alignment on small screens in case other
       global styles or third-party CSS change the default flow. */
    order: 2;
    /* Absolute-right placement with safe offset; stays on top of content */
    position: absolute;
    right: $space-3;
    top: 50%;
    transform: translateY(-50%);
    z-index: 20; /* Above other navbar content */

    /* Prevent ANY transform changes on hover/active to avoid layout shift */
    &:hover,
    &:focus,
    &:active {
      transform: translateY(-50%) !important; /* Must preserve centering */
    }
  }

  /* Ensure collapse content (nav links, search, actions) stacks below the
     toggler on small screens so the toggler remains at the right edge. */
  :global(.navbar-collapse) {
    order: 3;
    width: 100%;
  }

  .navbarBrandWrapper {
    order: 1;
  }

  /* When the mobile menu is open, position it below the navbar so it
     does not cover the navbar content. This makes the dropdown "drop"
     under the bar rather than overlaying it. */
  :global(.navbar-collapse.collapse.show) {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    width: 100%;
    background: #1e1e1e; /* Match navbar background */
    z-index: 15; /* Below the toggler but above page content */
    box-shadow: 0 8px 24px rgba(0,0,0,0.35);
    padding: $space-4 0;
    /* Smooth reveal animation */
    animation: slideDown 0.2s ease-out;
  }

  /* Ensure collapse children stack vertically and have expected spacing */
  :global(.navbar-collapse .navbar-nav) {
    display: flex;
    flex-direction: column;
    gap: $space-1;
    padding: 0 $space-4;
  }

  /* Mobile nav links need full width for easy tapping */
  .navbar :global(.nav-link),
  .navbar :global(.dropdown-toggle) {
    width: 100%;
    justify-content: flex-start;
    padding: $space-3 $space-4;
    margin: 0;
    border-radius: $radius-md;
  }

  /* Mobile dropdown menu styling */
  .navbar :global(.dropdown-menu) {
    position: static !important;
    width: 100%;
    background: rgba(255, 255, 255, 0.03);
    border: none;
    box-shadow: none;
    margin-top: $space-2;
    padding-left: $space-4;
  }

  /* Mobile dropdown items need full width */
  :global(.dropdown-item) {
    padding: $space-3 $space-4;
    border-radius: $radius-md;
  }
}

/* Nav link styling with theme colors and padding */
.navbar :global(.nav-link) {
  padding: $space-3 $space-4;
  margin: 0 $space-1;
  @include transition-all(var(--btn-transition));
  position: relative;
  color: white !important;
  opacity: 0.75;
  font-weight: $font-weight-bold; /* All nav items bold */
  /* WCAG 2.1 Level AA minimum touch target */
  min-height: var(--btn-height-md);
  @include flex-center;

  &:hover,
  &:focus {
    color: white !important; /* Same color as site title */
    background: transparent; /* No background change */
    opacity: 1;
  }

  /* Active state - full opacity to show current section */
  &.active {
    opacity: 1;
    color: white !important;
  }

  &:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  /* Better touch feedback on mobile */
  &:active {
    background: rgba(255, 255, 255, 0.05);
  }
}

/* Dropdown items */
:global(.dropdown-menu) {
  border-radius: $radius-md;
  box-shadow: var(--shadow-md);
  padding: 0;
  overflow: hidden;
  transform-origin: top;
  will-change: opacity, transform;
  display: none;
}

/* Dropdown toggle styling - match nav links, NOT button style */
.navbar :global(.dropdown-toggle) {
  padding: $space-3 $space-4;
  margin: 0 $space-1;
  color: white !important;
  opacity: 0.75;
  text-decoration: none !important;
  border: none;
  background: transparent;
  font-weight: $font-weight-bold;
  @include inline-stack($space-2);
  @include transition-all(var(--btn-transition));
  /* WCAG 2.1 Level AA minimum touch target */
  min-height: var(--btn-height-md);
  /* Override global .dropdown-toggle button styles from theme.scss */
  box-shadow: none !important;
  border-radius: 0;
  /* Prevent layout shift - fixed position in layout */
  position: relative;

  /* Ensure dropdown arrow is properly positioned */
  &::after {
    display: inline-block;
    margin-left: $space-2;
    vertical-align: middle;
    content: "";
    border-top: 0.3em solid;
    border-right: 0.3em solid transparent;
    border-bottom: 0;
    border-left: 0.3em solid transparent;
    /* Smooth rotation when open */
    transition: transform 0.2s ease;
  }

  /* Rotate arrow when open */
  &[aria-expanded="true"]::after {
    transform: rotate(180deg);
  }

  &:hover,
  &:focus,
  &[aria-expanded="true"] {
    color: white !important; /* Same color as site title */
    background: transparent; /* No background change */
    opacity: 1;
    /* Override global hover transform from theme.scss */
    transform: none !important;
    box-shadow: none !important;
  }

  /* Use inset outline to prevent layout shift */
  &:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: -2px; /* Inset to prevent layout shift */
  }

  /* Better touch feedback on mobile */
  &:active {
    background: rgba(255, 255, 255, 0.05);
  }
}

:global(.dropdown-item) {
  padding: $space-3 $space-5;
  @include transition-all(var(--btn-transition));
  font-weight: $font-weight-bold; /* All dropdown items bold */
  /* WCAG 2.1 Level AA minimum touch target */
  min-height: var(--btn-height-md);
  display: flex;
  align-items: center;

  /* First item should have rounded top corners */
  &:first-child {
    border-top-left-radius: $radius-md;
    border-top-right-radius: $radius-md;
  }

  /* Last item should have rounded bottom corners */
  &:last-child {
    border-bottom-left-radius: $radius-md;
    border-bottom-right-radius: $radius-md;
  }

  &:hover,
  &:focus {
    background: transparent; /* No background change */
    color: white !important; /* Same color as site title */
    transform: translateY(-2px); /* Slightly raised effect */
  }

  /* First item hover should maintain top corners, remove bottom corners */
  &:first-child:hover,
  &:first-child:focus {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  /* Last item hover should maintain bottom corners, remove top corners */
  &:last-child:hover,
  &:last-child:focus {
    border-top-left-radius: 0;
    border-top-right-radius: 0;
  }

  /* Active state - NO background highlight for previous item */
  &.active {
    background: var(--gradient-primary) !important;
    color: white !important;
  }

  /* Touch feedback on mobile */
  &:active {
    background: rgba(255, 255, 255, 0.05) !important;
    color: white !important;
    transform: scale(0.98);
  }

  &:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: -2px;
  }
}

/* Dropdown divider styling */
:global(.dropdown-menu .dropdown-divider) {
  margin: 0;
  opacity: 0.2; /* Custom opacity for subtle divider */
}

/* Navbar brand */
:global(.navbar-brand) {
  display: flex; /* Ensure flex layout */
  flex-wrap: nowrap; /* Keep logo and text on same line */
  align-items: baseline; /* Align logo and text to text baseline for pixel-perfect alignment */
  gap: $space-2; /* Add gap between logo and text */
  padding: $space-2 $space-4;
  @include transition-all($transition-normal);
  color: white !important;

  &:hover,
  &:focus {
    color: white !important;
  }

  &:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
    border-radius: $radius-md;
  }
}

/* Custom collapse transitions for mobile menu */
:global(.navbar-collapse.collapsing) {
  height: 0;
  overflow: hidden;
  transition: height 0.35s ease; /* Custom timing for collapse animation */
}

:global(.navbar-collapse.collapse:not(.show)) {
  display: none;
}

:global(.navbar-collapse.collapse.show) {
  display: block;
}

/* Navbar search integration */
.navbarSearch {
  flex: 0 1 400px;
  max-width: 400px;
  margin-left: $space-4;
  margin-right: $space-4;
}

@include breakpoint-max(lg) {
  .navbarSearch {
    flex: 1 1 100%;
    max-width: 100%;
    margin: $space-2 0;
  }
}

/* Navbar actions container */
.navbarActions {
  flex-shrink: 0;
  margin-left: auto;
}

@include breakpoint-max(lg) {
  .navbarActions {
    width: 100%;
    margin-top: $space-2;
  }
}

/* Mobile menu toggle button - always visible on dark navbar */
:global(.navbar-toggler) {
  border-color: rgba(255, 255, 255, 0.3) !important;
  padding: $space-2;
  /* WCAG 2.1 Level AA minimum touch target */
  min-width: var(--btn-height-md);
  min-height: var(--btn-height-md);
  @include flex-center;
  /* Prevent layout shift on transform */
  transform-origin: center center;

  &:focus {
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.5);
  }

  /* Better active/touch feedback for mobile - use box-shadow instead of scale to avoid layout shift */
  &:active {
    background: rgba(255, 255, 255, 0.15);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
  }
}

:global(.navbar-toggler-icon) {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(255, 255, 255, 0.85)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
  width: 24px;
  height: 24px;
}
