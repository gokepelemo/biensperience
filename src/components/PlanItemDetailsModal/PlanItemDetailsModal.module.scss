@use '../../styles/scss/abstracts' as *;

/* Plan Item Details Modal - Theme-aware, mobile-friendly design */

/* Editable title in modal header */
.editableTitle {
  cursor: pointer;
  padding: $space-1 $space-2;
  margin: -#{$space-1} -#{$space-2};
  border-radius: var(--radius-sm);
  transition: background-color var(--transition-fast), text-decoration-color var(--transition-fast);
  text-decoration: underline;
  text-decoration-style: dotted;
  text-decoration-color: currentColor;
  text-underline-offset: 3px;
  opacity: 0.85;

  &:hover {
    background: rgba(255, 255, 255, 0.15);
    text-decoration-style: solid;
    text-decoration-color: currentColor;
    opacity: 1;
  }

  &:focus {
    outline: 2px solid var(--color-white);
    outline-offset: 2px;
    opacity: 1;
  }
}

.titleInput {
  width: 100%;
  min-width: 200px;
  padding: $space-1 $space-2;
  font-size: inherit;
  font-weight: inherit;
  font-family: inherit;
  color: var(--color-text-primary);
  background: var(--color-bg-primary);
  border: 2px solid var(--color-primary);
  border-radius: var(--radius-sm);
  outline: none;
  box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.2);

  &:focus {
    border-color: var(--color-primary);
  }

  @media (max-width: 768px) {
    min-width: 150px;
  }
}

.planItemDetailsModal {
  padding: 0;
  background: var(--color-bg-primary);
  border-radius: var(--radius-lg); /* Match modal content border radius */
  overflow: hidden;
  /* Robust flexbox container for Safari - explicit column layout */
  display: flex;
  flex-direction: column;
  /* Triple height declaration for maximum Safari compatibility */
  height: 100%;
  min-height: 0; /* Allow flexbox to shrink below content size */
  max-height: 100%; /* Prevent overflow beyond parent */
  /* Flex item properties when inside modal body */
  flex: 1 1 0;
}

/* Custom modal body class for fullscreen height */
.modalBodyFullscreen {
  height: 100%;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Link bar - shown when plan item has external URL */
.planItemLinkBar {
  padding: $space-3 $space-6;
  background: var(--color-bg-secondary);
  border-bottom: 1px solid var(--color-border-light);
  display: flex;
  justify-content: flex-end;

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
  }
}

.planItemLink {
  @include button-base;
  font-size: $font-size-sm;
  color: var(--color-primary);
  background: transparent;
  border: 1px solid var(--color-primary);
  text-decoration: none;
  white-space: nowrap;
  padding: $space-2 $space-4;
  border-radius: var(--radius-md);

  &:hover {
    background: rgba(var(--color-primary-rgb), 0.1);
    color: var(--color-primary);
    transform: translateY(-1px);
  }
}

/* Assignment section */
.assignmentSection {
  padding: $space-5 $space-6;
  background: var(--color-bg-secondary);
  margin-bottom: 0;
  display: flex;
  align-items: center;
  gap: $space-3;
  border-top: 1px solid var(--color-border-light);
  border-bottom: 1px solid var(--color-border-light);

  @media (max-width: 768px) {
    flex-direction: column;
    align-items: flex-start;
    padding: $space-4;
  }
}

.assignmentLabel {
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  color: var(--color-text-muted);
  margin: 0;
}

.assignmentAutocompleteWrapper {
  flex: 1;
  position: relative;
}

.assignmentLink {
  width: 100%;
  padding: $space-2 $space-3;
  font-size: $font-size-base;
  color: var(--color-primary);
  text-align: left;
  background: transparent;
  border: none;
  cursor: pointer;
  @include transition-all($transition-fast);
  border-radius: var(--radius-md);
  text-decoration: underline;
  text-decoration-style: dotted;

  &:hover {
    background: rgba(var(--color-primary-rgb), 0.1);
    text-decoration-style: solid;
  }
}

.assignmentAutocomplete {
  position: relative;
  width: 100%;
}

.assignmentInput {
  @include form-control;
  width: 100%;
  padding: $space-2 $space-3;
  font-size: $font-size-sm;
  background: var(--color-bg-primary);
  color: var(--color-text-primary);
  border-color: var(--color-border-medium);

  &::placeholder {
    color: var(--color-text-muted);
  }

  &:focus {
    @include focus-ring;
    background: var(--color-bg-primary);
  }
}

.assignmentSelect {
  @media (max-width: 768px) {
    width: 100%;
  }
}

.assignmentDropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  margin-top: $space-1;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  max-height: 200px;
  overflow-y: auto;
  z-index: $z-index-modal-dropdown; /* Dropdowns inside modals need higher z-index than modal */
}

.assignmentOption {
  padding: $space-2 $space-3;
  font-size: $font-size-sm;
  color: var(--color-text-primary);
  cursor: pointer;
  @include transition-all($transition-fast);
  border-bottom: 1px solid var(--color-border-light);

  &:last-child {
    border-bottom: none;
  }

  &:hover,
  &.highlighted {
    background: rgba(var(--color-primary-rgb), 0.15);
    color: var(--color-primary);
  }

  &.disabled {
    color: var(--color-text-muted);
    cursor: not-allowed;
    font-style: italic;

    &:hover {
      background: transparent;
    }
  }
}

.assignmentOptionText {
  @include text-ellipsis;
}

.assignmentValue {
  flex: 1;
  font-size: $font-size-base;
  color: var(--color-text-primary);
}

/* Completion toggle - positioned next to assignment */
.completionToggle {
  display: flex;
  align-items: center;
  margin-left: auto;
  padding-left: $space-4;
  border-left: 1px solid var(--color-border-light);

  @media (max-width: 768px) {
    margin-left: 0;
    padding-left: 0;
    padding-top: $space-3;
    border-left: none;
    border-top: 1px solid var(--color-border-light);
    width: 100%;
  }
}

.completeButton {
  display: flex;
  align-items: center;
  gap: $space-2;
  padding: $space-2 $space-4;
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  color: var(--color-text-secondary);
  background: transparent;
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  cursor: pointer;
  @include transition-all($transition-fast);

  &:hover:not(:disabled) {
    background: rgba(var(--color-success-rgb, 34, 197, 94), 0.1);
    border-color: var(--color-success, #22c55e);
    color: var(--color-success, #22c55e);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  &.completed {
    background: rgba(var(--color-success-rgb, 34, 197, 94), 0.15);
    border-color: var(--color-success, #22c55e);
    color: var(--color-success, #22c55e);

    &:hover:not(:disabled) {
      background: rgba(var(--color-success-rgb, 34, 197, 94), 0.25);
    }
  }

  @media (max-width: 768px) {
    width: 100%;
    justify-content: center;
  }
}

.completeIcon {
  font-size: $font-size-base;
  line-height: 1;
}

.completeText {
  white-space: nowrap;
}

/* Details tabs */
.detailsTabs {
  display: flex;
  gap: 0;
  border-bottom: 1px solid var(--color-border-light);
  margin-bottom: 0;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding: 0 $space-6;
  background: var(--color-bg-secondary);

  @media (max-width: 768px) {
    padding: 0 $space-4;
  }
}

.detailsTab {
  padding: $space-4 $space-5;
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  border: none;
  background: transparent;
  color: var(--color-text-muted);
  cursor: pointer;
  border-bottom: 2px solid transparent;
  @include transition-all($transition-fast);
  white-space: nowrap;
  position: relative;
  bottom: -1px;

  &:hover:not(.disabled) {
    color: var(--color-primary);
    background: rgba(var(--color-primary-rgb), 0.05);
  }

  &.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
    font-weight: $font-weight-semibold;
  }

  &.disabled {
    opacity: 0.4;
    cursor: not-allowed;
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
    font-size: $font-size-xs;
  }
}

/* Details content - THE CRITICAL FLEX FILL CONTAINER
 * This is the primary content area that must fill all remaining vertical space.
 * It sits between fixed-height sections (assignment, cost, tabs) and must
 * expand to fill whatever space is left.
 */
.detailsContent {
  /* Flexbox fill pattern - grow to fill, shrink if needed, start from 0 */
  flex: 1 1 0;
  /* Critical: Allow flex item to shrink below intrinsic content size */
  min-height: 0;
  /* Explicit height for Safari which sometimes ignores flex-grow */
  height: 100%;
  /* Prevent overflow - children handle their own scrolling */
  overflow: hidden;
  /* Remove padding - children handle their own padding */
  padding: 0;
  background: var(--color-bg-primary);
  /* This is also a flex container for its children */
  display: flex;
  flex-direction: column;

  /* Mobile: Enable scrolling for content that overflows */
  @media (max-width: 768px) {
    /* Allow vertical scrolling on mobile */
    overflow-y: auto;
    /* Smooth scrolling on iOS */
    -webkit-overflow-scrolling: touch;
    /* Prevent scroll chaining to parent */
    overscroll-behavior: contain;
  }
}

/* Notes tab wrapper - explicit styles for PlanItemNotes to fill available height
 * This wrapper ensures the PlanItemNotes component gets 100% of available vertical space.
 * The flex chain is: modal > modalBody > planItemDetailsModal > detailsContent > notesTabWrapper > PlanItemNotes
 */
.notesTabWrapper {
  /* Flex container for PlanItemNotes */
  display: flex;
  flex-direction: column;
  /* Fill all available space */
  flex: 1 1 0;
  /* Allow shrinking below content size - critical for Safari */
  min-height: 0;
  /* Explicit height for Safari fallback */
  height: 100%;
  /* Max height prevents overflow */
  max-height: 100%;
  /* Let PlanItemNotes handle its own scrolling */
  overflow: hidden;
  /* Ensure width fills container */
  width: 100%;

  /* Mobile: Minimum height to ensure usability */
  @media (max-width: 768px) {
    min-height: 300px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
}

.comingSoonMessage {
  @include flex-center;
  flex: 1; /* Fill available space */
  min-height: 200px;
  color: var(--color-text-muted);
  font-style: italic;
  font-size: $font-size-base;
}

.chatTabWrapper {
  display: flex;
  flex-direction: column;
  flex: 1 1 0;
  min-height: 0;
  overflow: hidden;
  padding: $space-4;
  gap: $space-3;

  /* Mobile: Enable scrolling and minimum height */
  @media (max-width: 768px) {
    min-height: 300px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
}

.chatLoading {
  color: var(--color-text-muted);
}

.chatContainer {
  flex: 1 1 0;
  min-height: 0;
  overflow: hidden;
}

.chatContainer :global(.str-chat__container) {
  height: 100%;
}

.chatContainer :global(.str-chat) {
  height: 100%;
}

/* Stream Chat dark mode compatibility using design tokens */
/* Base containers */
.chatContainer :global(.str-chat),
.chatContainer :global(.str-chat__channel),
.chatContainer :global(.str-chat__main-panel),
.chatContainer :global(.str-chat__window),
.chatContainer :global(.str-chat__container) {
  background: var(--color-bg-primary) !important;
  color: var(--color-text-primary);
}

/* Channel header */
.chatContainer :global(.str-chat__channel-header) {
  background: var(--color-bg-secondary) !important;
  border-bottom: 1px solid var(--color-border-light);
  color: var(--color-text-primary);
}

/* Message list container */
.chatContainer :global(.str-chat__message-list),
.chatContainer :global(.str-chat__message-list-scroll),
.chatContainer :global(.str-chat__list) {
  background: var(--color-bg-primary) !important;
}

/* Virtual message list (v2) */
.chatContainer :global(.str-chat__virtual-list),
.chatContainer :global(.str-chat__virtual-list__wrapper) {
  background: var(--color-bg-primary) !important;
}

/* Message input wrapper and container */
.chatContainer :global(.str-chat__message-input),
.chatContainer :global(.str-chat__input-flat),
.chatContainer :global(.str-chat__input-flat-wrapper),
.chatContainer :global(.str-chat__message-input-inner) {
  background: var(--color-bg-primary) !important;
  border-top: 1px solid var(--color-border-light);
}

/* Textarea and input - use same background as container for consistency */
.chatContainer :global(.str-chat__textarea textarea),
.chatContainer :global(.str-chat__message-textarea),
.chatContainer :global(.str-chat__textarea) {
  background: var(--color-bg-secondary) !important;
  color: var(--color-text-primary) !important;
  border: 1px solid var(--color-border-light) !important;
  border-radius: var(--radius-md) !important;

  &::placeholder {
    color: var(--color-text-muted) !important;
  }

  &:focus {
    border-color: var(--color-primary) !important;
    box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2) !important;
  }
}

/* Send button */
.chatContainer :global(.str-chat__send-button),
.chatContainer :global(.str-chat__send-button svg) {
  color: var(--color-primary);

  &:hover {
    color: var(--color-primary-dark);
  }
}

/* Messages */
.chatContainer :global(.str-chat__message-simple),
.chatContainer :global(.str-chat__message) {
  color: var(--color-text-primary);
}

.chatContainer :global(.str-chat__message-text),
.chatContainer :global(.str-chat__message-text-inner) {
  color: var(--color-text-primary);
}

.chatContainer :global(.str-chat__message-simple-text-inner),
.chatContainer :global(.str-chat__message-bubble) {
  background: var(--color-bg-tertiary) !important;
  border-color: var(--color-border-light);
  color: var(--color-text-primary);
}

.chatContainer :global(.str-chat__message-simple--me .str-chat__message-simple-text-inner),
.chatContainer :global(.str-chat__message--me .str-chat__message-bubble) {
  background: var(--color-primary) !important;
  color: var(--color-white) !important;
}

/* Avatar */
.chatContainer :global(.str-chat__avatar),
.chatContainer :global(.str-chat__avatar-image) {
  background: var(--color-bg-tertiary);
}

/* Date separator */
.chatContainer :global(.str-chat__date-separator-line) {
  background: var(--color-border-light);
}

.chatContainer :global(.str-chat__date-separator-date) {
  color: var(--color-text-muted);
  background: var(--color-bg-primary);
}

/* Empty channel state - the "No chats here yet" message */
.chatContainer :global(.str-chat__empty-channel),
.chatContainer :global(.str-chat__channel-empty-container) {
  background: var(--color-bg-primary) !important;
  color: var(--color-text-secondary) !important;
}

/* Empty state icon */
.chatContainer :global(.str-chat__empty-channel svg),
.chatContainer :global(.str-chat__channel-empty-container svg) {
  color: var(--color-text-muted) !important;
  fill: var(--color-text-muted) !important;
}

/* Loading state */
.chatContainer :global(.str-chat__loading-channel),
.chatContainer :global(.str-chat__loading-channels) {
  background: var(--color-bg-primary) !important;
  color: var(--color-text-secondary);
}

/* Thread container */
.chatContainer :global(.str-chat__thread),
.chatContainer :global(.str-chat__thread-container) {
  background: var(--color-bg-primary) !important;
}

/* Typing indicator */
.chatContainer :global(.str-chat__typing-indicator) {
  color: var(--color-text-muted);
}

/* Reactions */
.chatContainer :global(.str-chat__reaction-selector) {
  background: var(--color-bg-secondary) !important;
  border-color: var(--color-border-light);
}

/* Attachment previews */
.chatContainer :global(.str-chat__attachment-preview),
.chatContainer :global(.str-chat__file-input-container) {
  background: var(--color-bg-tertiary) !important;
  border-color: var(--color-border-medium);
}

/* Quoted message */
.chatContainer :global(.str-chat__quoted-message-preview) {
  background: var(--color-bg-tertiary) !important;
  border-color: var(--color-border-light);
  color: var(--color-text-secondary);
}

/* Message actions dropdown/menu */
.chatContainer :global(.str-chat__message-actions-box),
.chatContainer :global(.str-chat__message-actions-list),
.chatContainer :global(.str-chat__message-actions) {
  background: var(--color-bg-secondary) !important;
  border: 1px solid var(--color-border-medium) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  border-radius: var(--radius-md) !important;
}

.chatContainer :global(.str-chat__message-actions-list-item),
.chatContainer :global(.str-chat__message-actions-list button) {
  background: transparent !important;
  color: var(--color-text-primary) !important;

  &:hover {
    background: var(--color-bg-hover) !important;
  }
}

/* Message options button (three dots) */
.chatContainer :global(.str-chat__message-simple__actions__action--options),
.chatContainer :global(.str-chat__message-actions-container button) {
  color: var(--color-text-secondary);

  &:hover {
    color: var(--color-text-primary);
    background: var(--color-bg-hover);
  }
}

/* Emoji picker and reactions dropdown */
.chatContainer :global(.str-chat__emoji-picker-react),
.chatContainer :global(.str-chat__reaction-list) {
  background: var(--color-bg-secondary) !important;
  border-color: var(--color-border-medium) !important;
}

/* Reaction selector - the emoji picker popup/pill */
.chatContainer :global(.str-chat__reaction-selector),
.chatContainer :global(.str-chat__reaction-selector-list),
.chatContainer :global(.str-chat__simple-reactions-list-container),
.chatContainer :global(.str-chat__simple-reactions-list) {
  background: var(--color-bg-secondary) !important;
  border: 1px solid var(--color-border-medium) !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25) !important;
  border-radius: 999px !important;
}

/* Individual reaction buttons in the selector */
.chatContainer :global(.str-chat__reaction-selector-button),
.chatContainer :global(.str-chat__reaction-selector li),
.chatContainer :global(.str-chat__simple-reactions-list-item) {
  background: transparent !important;
  border-radius: 50% !important;

  &:hover {
    background: var(--color-bg-hover) !important;
  }
}

/* Reactions shown on messages */
.chatContainer :global(.str-chat__message-reactions-list),
.chatContainer :global(.str-chat__message-reactions-list-item),
.chatContainer :global(.str-chat__reaction-bubble) {
  background: var(--color-bg-tertiary) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border-light) !important;
}

/* Thread panel and header */
.chatContainer :global(.str-chat__thread),
.chatContainer :global(.str-chat__thread-container),
.chatContainer :global(.str-chat__thread-list) {
  background: var(--color-bg-primary) !important;
  color: var(--color-text-primary);
  border-left: 1px solid var(--color-border-light) !important;
}

.chatContainer :global(.str-chat__thread-header) {
  background: var(--color-bg-primary) !important;
  border-bottom: 1px solid var(--color-border-light) !important;
  color: var(--color-text-primary) !important;
}

.chatContainer :global(.str-chat__thread-header-title),
.chatContainer :global(.str-chat__thread-header__title),
.chatContainer :global(.str-chat__thread-header strong) {
  color: var(--color-text-primary) !important;
}

.chatContainer :global(.str-chat__thread-header-subtitle),
.chatContainer :global(.str-chat__thread-header__subtitle),
.chatContainer :global(.str-chat__thread-header span) {
  color: var(--color-text-secondary) !important;
}

/* Thread close button */
.chatContainer :global(.str-chat__thread-header-close-button),
.chatContainer :global(.str-chat__thread-header button),
.chatContainer :global(.str-chat__close-thread-button) {
  color: var(--color-text-secondary) !important;
  background: transparent !important;

  &:hover {
    color: var(--color-text-primary) !important;
    background: var(--color-bg-hover) !important;
  }
}

/* Thread message list */
.chatContainer :global(.str-chat__thread-message-list),
.chatContainer :global(.str-chat__thread .str-chat__message-list) {
  background: var(--color-bg-primary) !important;
}

/* Thread message input - same styling as main input */
.chatContainer :global(.str-chat__thread .str-chat__message-input),
.chatContainer :global(.str-chat__thread .str-chat__input-flat),
.chatContainer :global(.str-chat__thread .str-chat__input-flat-wrapper) {
  background: var(--color-bg-primary) !important;
  border-top: 1px solid var(--color-border-light) !important;
}

.chatContainer :global(.str-chat__thread .str-chat__textarea textarea) {
  background: var(--color-bg-secondary) !important;
  color: var(--color-text-primary) !important;
  border: 1px solid var(--color-border-light) !important;
  border-radius: var(--radius-md) !important;
}

/* Reply count button */
.chatContainer :global(.str-chat__message-replies-count-button),
.chatContainer :global(.str-chat__message-replies-count) {
  color: var(--color-primary) !important;
  background: transparent !important;

  &:hover {
    text-decoration: underline;
  }
}

/* Context menu / popover */
.chatContainer :global(.str-chat__popover),
.chatContainer :global(.str-chat__tooltip) {
  background: var(--color-bg-secondary) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border-medium) !important;
}

/* Ensure Stream Chat main panel and message list expand and become scrollable
   so the visible messages area fills the vertical space of the modal. */
.chatContainer :global(.str-chat__main-panel),
.chatContainer :global(.str-chat__window) {
  display: flex;
  flex-direction: column;
  flex: 1 1 auto;
  min-height: 0;
  overflow: hidden;
}

.chatContainer :global(.str-chat__message-list) {
  flex: 1 1 auto;
  min-height: 0;
  overflow: auto;
}

/* Send to channel checkbox styling - matches Checkbox component */
.chatContainer :global(.str-chat__send-to-channel-checkbox__field input[type="checkbox"]) {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.chatContainer :global(.str-chat__send-to-channel-checkbox__field) {
  display: inline-flex;
  align-items: center;
  gap: var(--space-3);
  cursor: pointer;
  user-select: none;
}

.chatContainer :global(.str-chat__send-to-channel-checkbox__field label) {
  display: inline-flex;
  align-items: center;
  gap: var(--space-3);
  cursor: pointer;
  user-select: none;
  position: relative;
  color: var(--color-text-primary);
  font-size: var(--font-size-sm);
  /* Remove upstream Stream Chat padding so our gap controls spacing */
  padding-inline: 0;
}

/* Square box as pseudo-element so the label text remains visible */
.chatContainer :global(.str-chat__send-to-channel-checkbox__field label::before) {
  content: '';
  flex: none;
  width: 24px;
  height: 24px;
  border: 2px solid var(--color-border-medium);
  background: var(--color-bg-primary);
  border-radius: var(--radius-md);
  transition: all var(--transition-base);
  box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
  display: inline-block;
}

/* Checkmark icon positioned over the box */
.chatContainer :global(.str-chat__send-to-channel-checkbox__field label::after) {
  content: '';
  position: absolute;
  /* position the checkmark centered inside the 24px box (2px border) */
  /* expand to occupy most of the inner box for a bold appearance */
  left: 3px;
  top: 50%;
  transform: translateY(-50%) scale(1);
  width: 18px;
  height: 18px;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 18px 18px;
  opacity: 0;
  pointer-events: none;
}

.chatContainer :global(.str-chat__send-to-channel-checkbox__field input[type="checkbox"]:checked + label::before) {
  border-color: transparent;
  background: var(--gradient-primary);
}

.chatContainer :global(.str-chat__send-to-channel-checkbox__field input[type="checkbox"]:checked + label::after) {
  opacity: 1;
  /* larger/thicker checkmark so it visually fills the checkbox */
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolyline points='20 6 9 17 4 12' fill='none' stroke='white' stroke-width='4' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
}

.chatContainer :global(.str-chat__send-to-channel-checkbox__field input[type="checkbox"]:focus + label::before),
.chatContainer :global(.str-chat__send-to-channel-checkbox__field:hover input[type="checkbox"] + label::before) {
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px var(--color-primary-alpha-25, rgba(102, 126, 234, 0.25));
}

/* Pagination */
.pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: $space-4 $space-6;
  margin-top: $space-4;
  border-top: 1px solid var(--color-border-light);
  background: var(--color-bg-secondary);

  @media (max-width: 768px) {
    flex-direction: column;
    gap: $space-3;
    padding: $space-4;
  }
}

.paginationBtn {
  @include button-base;
  background: transparent;
  border: 2px solid var(--color-border-medium);
  color: var(--color-text-primary);
  padding: $space-2 $space-4;
  font-size: $font-size-sm;

  &:hover:not(:disabled) {
    @include hover-lift;
    background: var(--color-bg-hover);
    border-color: var(--color-primary);
    color: var(--color-primary);
  }

  &:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
}

.paginationInfo {
  font-size: $font-size-sm;
  color: var(--color-text-muted);

  @media (max-width: 768px) {
    order: -1;
  }
}

/* Cost & Planning Info Section */
.costPlanningSection {
  display: flex;
  flex-wrap: wrap;
  gap: $space-3;
  padding: $space-4 $space-6;
  background: var(--color-bg-tertiary);
  border-bottom: 1px solid var(--color-border-light);

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
    gap: $space-2;
  }
}

.infoCard {
  display: flex;
  align-items: flex-start;
  gap: $space-2;
  padding: $space-3 $space-4;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border-light);
  min-width: 140px;
  flex: 1 1 auto;
  max-width: 200px;
  @include transition-all($transition-fast);

  &:hover {
    border-color: var(--color-border-medium);
    box-shadow: var(--shadow-sm);
  }

  @media (max-width: 768px) {
    min-width: 120px;
    max-width: none;
    flex: 1 1 calc(50% - $space-2);
    padding: $space-2 $space-3;
  }
}

.infoIcon {
  font-size: $font-size-lg;
  line-height: 1;
  flex-shrink: 0;
}

.infoContent {
  display: flex;
  flex-direction: column;
  gap: $space-1;
  min-width: 0;
  flex: 1;
}

.infoLabel {
  display: flex;
  align-items: center;
  font-size: $font-size-xs;
  font-weight: $font-weight-medium;
  color: var(--color-text-muted);
  text-transform: uppercase;
  letter-spacing: 0.03em;
  line-height: 1;
}

.infoValue {
  font-size: $font-size-base;
  font-weight: $font-weight-semibold;
  color: var(--color-text-primary);
  @include text-ellipsis;
}

/* Scheduled date card - clickable to edit date/time */
.scheduledDateCard {
  max-width: 280px;
  cursor: pointer;
  @include transition-all($transition-fast);

  &:hover {
    background: var(--color-bg-hover);
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  @media (max-width: 768px) {
    max-width: none;
  }
}

/* Scheduled date value - dotted underline to indicate editable */
.scheduledDateValue {
  font-size: $font-size-base;
  font-weight: $font-weight-semibold;
  color: var(--color-text-primary);
  line-height: 1.3;
  text-decoration: underline dotted var(--color-text-muted);
  text-underline-offset: 3px;
}

/* Scheduled time within info value */
.scheduledTime {
  font-weight: $font-weight-normal;
  color: var(--color-text-secondary);
  font-size: $font-size-sm;
}

/* Cost breakdown list */
.costBreakdown {
  width: 100%;
  margin-top: $space-2;
  padding-top: $space-2;
  border-top: 1px dashed var(--color-border-light);
  display: flex;
  flex-direction: column;
  gap: $space-1;
}

.costItem {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: $space-2;
  padding: $space-1 0;
  font-size: $font-size-sm;

  &:not(:last-child) {
    border-bottom: 1px dashed var(--color-border-light);
    padding-bottom: $space-2;
  }
}

.costTitle {
  color: var(--color-text-secondary);
  flex: 1;
  min-width: 0;
  @include text-ellipsis;
}

.costAmount {
  color: var(--color-primary);
  font-weight: $font-weight-medium;
  white-space: nowrap;
}

/* Add Cost Button - inline cost addition */
.addCostButton {
  display: flex;
  align-items: center;
  gap: $space-2;
  padding: $space-2 $space-4;
  background: transparent;
  border: 1px dashed var(--color-border-medium);
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  cursor: pointer;
  @include transition-all($transition-fast);
  min-width: 120px;
  justify-content: center;

  &:hover {
    background: rgba(var(--color-primary-rgb), 0.1);
    border-color: var(--color-primary);
    border-style: solid;
    color: var(--color-primary);
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  @media (max-width: 768px) {
    flex: 1 1 100%;
    min-width: 0;
  }
}

.addCostIcon {
  font-size: $font-size-lg;
  line-height: 1;
  font-weight: $font-weight-bold;
}

.addCostText {
  white-space: nowrap;
}

/* + Add Button with Dropdown */
.addDropdownWrapper {
  position: relative;
  display: inline-flex;
}

.addButton {
  display: flex;
  align-items: center;
  gap: $space-2;
  padding: $space-2 $space-4;
  background: var(--gradient-primary);
  border: none;
  border-radius: var(--radius-md);
  color: white;
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  cursor: pointer;
  @include transition-all($transition-fast);
  min-width: 100px;
  justify-content: center;

  &:hover {
    @include hover-lift;
    opacity: 0.95;
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  @media (max-width: 768px) {
    flex: 1 1 100%;
    min-width: 0;
  }
}

.addButtonIcon {
  font-size: $font-size-lg;
  line-height: 1;
  font-weight: $font-weight-bold;
}

.addButtonText {
  white-space: nowrap;
}

.addButtonCaret {
  font-size: $font-size-xs;
  opacity: 0.8;
  margin-left: $space-1;
}

.addDropdownMenu {
  position: absolute;
  top: calc(100% + $space-2);
  right: 0;
  min-width: 280px;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  z-index: $z-index-modal-dropdown; /* Dropdowns inside modals need higher z-index than modal */
  overflow: hidden;
  max-height: 340px;
  display: flex;
  flex-direction: column;

  @media (max-width: 768px) {
    left: 0;
    right: 0;
    min-width: 100%;
  }
}

.addDropdownItem {
  display: flex;
  align-items: center;
  gap: $space-3;
  width: 100%;
  padding: $space-3 $space-4;
  background: transparent;
  border: none;
  text-align: left;
  cursor: pointer;
  @include transition-all($transition-fast);
  border-bottom: 1px solid var(--color-border-light);

  &:last-child {
    border-bottom: none;
  }

  &:hover {
    background: rgba(var(--color-primary-rgb), 0.1);
  }

  &:focus {
    outline: none;
    background: rgba(var(--color-primary-rgb), 0.15);
  }
}

.addDropdownIcon {
  font-size: $font-size-lg;
  line-height: 1;
  flex-shrink: 0;
}

.addDropdownLabel {
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  color: var(--color-text-primary);
}

/* Filter input wrapper in Add dropdown */
.addDropdownFilterWrapper {
  padding: $space-2 $space-3;
  border-bottom: 1px solid var(--color-border-light);
  background: var(--color-bg-secondary);
  position: sticky;
  top: 0;
  z-index: 1;
}

.addDropdownFilterInput {
  width: 100%;
  padding: $space-2 $space-3;
  font-size: $font-size-sm;
  color: var(--color-text-primary);
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  outline: none;
  @include transition-all($transition-fast);

  &::placeholder {
    color: var(--color-text-muted);
  }

  &:focus {
    border-color: var(--color-primary);
    box-shadow: 0 0 0 2px rgba(var(--color-primary-rgb), 0.15);
  }
}

/* Scrollable items container */
.addDropdownItems {
  max-height: 260px;
  overflow-y: auto;
}

/* No results message */
.addDropdownNoResults {
  padding: $space-4;
  text-align: center;
  font-size: $font-size-sm;
  color: var(--color-text-muted);
}

/* Action Buttons Stack - vertical layout for Add and Share buttons */
.actionButtonsStack {
  display: flex;
  flex-direction: column;
  gap: $space-2;
  min-width: 100px;

  @media (max-width: 768px) {
    flex: 1 1 100%;
    min-width: 0;
  }
}

/* Share Button - matches Add button styling */
.shareButton {
  display: flex;
  align-items: center;
  gap: $space-2;
  padding: $space-2 $space-4;
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  color: var(--color-text-primary);
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  cursor: pointer;
  @include transition-all($transition-fast);
  justify-content: center;
  width: 100%;

  &:hover {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
    @include hover-lift;
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
}

.shareButtonIcon {
  font-size: $font-size-base;
  line-height: 1;
}

.shareButtonText {
  white-space: nowrap;
}

/* =============================================
   Details Tab Content - Grouped Detail Types
   ============================================= */

/* Details Tab Content - Container for grouped detail types
 * This must fill 100% of available vertical space within detailsContent.
 * Contains: detailsExportBar (fixed) + detailsGroupedList (scrollable)
 */
.detailsTabContent {
  /* Flex column container */
  display: flex;
  flex-direction: column;
  /* Fill available space */
  flex: 1 1 0;
  /* Explicit height for Safari */
  height: 100%;
  /* Max height prevents overflow */
  max-height: 100%;
  /* Allow shrinking below content size */
  min-height: 0;
  /* Prevent overflow - detailsGroupedList handles scrolling */
  overflow: hidden;
  /* Full width */
  width: 100%;

  /* Mobile: Enable scrolling and ensure usable height */
  @media (max-width: 768px) {
    min-height: 300px;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
}

/* Export bar at top of details tab */
.detailsExportBar {
  display: flex;
  justify-content: flex-end;
  padding: $space-3 $space-6;
  border-bottom: 1px solid var(--color-border-light);
  background: var(--color-bg-secondary);
  flex-shrink: 0;

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
  }
}

.exportPdfButton {
  display: flex;
  align-items: center;
  gap: $space-2;
  padding: $space-2 $space-4;
  background: var(--color-bg-primary);
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  color: var(--color-text-primary);
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  cursor: pointer;
  @include transition-all($transition-fast);

  &:hover {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
}

.exportPdfIcon {
  font-size: $font-size-base;
  line-height: 1;
}

/* Scrollable grouped list container - THE SCROLLABLE CONTENT AREA
 * This must fill remaining vertical space after the export bar.
 */
.detailsGroupedList {
  /* Fill remaining vertical space */
  flex: 1 1 0;
  /* Allow shrinking below content size - critical for Safari */
  min-height: 0;
  /* Explicit height for Safari fallback */
  height: 100%;
  /* Enable vertical scrolling */
  overflow-y: auto;
  /* Prevent horizontal overflow */
  overflow-x: hidden;
  padding: $space-4 $space-6;
  display: flex;
  flex-direction: column;
  gap: $space-5;
  /* Prevent scroll chaining to parent */
  overscroll-behavior: contain;
  /* Smooth scrolling on iOS */
  -webkit-overflow-scrolling: touch;

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
    gap: $space-4;
  }
}

/* Category group container */
.detailsCategory {
  background: var(--color-bg-secondary);
  border: 1px solid var(--color-border-light);
  border-radius: var(--radius-lg);
  overflow: hidden;
}

.detailsCategoryTitle {
  display: flex;
  align-items: center;
  gap: $space-3;
  padding: $space-3 $space-4;
  background: var(--color-bg-tertiary);
  border-bottom: 1px solid var(--color-border-light);
  margin: 0;
  font-size: $font-size-base;
  font-weight: $font-weight-semibold;
  color: var(--color-text-primary);
}

.detailsCategoryIcon {
  font-size: $font-size-lg;
  line-height: 1;
}

.detailsCategoryCount {
  margin-left: auto;
  padding: $space-1 $space-2;
  background: rgba(var(--color-primary-rgb), 0.15);
  color: var(--color-primary);
  font-size: $font-size-xs;
  font-weight: $font-weight-semibold;
  border-radius: var(--radius-full);
  min-width: 24px;
  text-align: center;
}

.detailsCategoryItems {
  display: flex;
  flex-direction: column;
}

/* Individual detail item */
.detailItem {
  padding: $space-4;
  border-bottom: 1px solid var(--color-border-light);
  @include transition-all($transition-fast);

  &:last-child {
    border-bottom: none;
  }

  &:hover {
    background: rgba(var(--color-primary-rgb), 0.03);
  }
}

.detailItemHeader {
  display: flex;
  align-items: center;
  gap: $space-2;
  margin-bottom: $space-2;
}

.detailItemIcon {
  font-size: $font-size-lg;
  line-height: 1;
}

.detailItemType {
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  color: var(--color-text-secondary);
}

.detailItemContent {
  padding-left: $space-5; /* Align with header text */

  @media (max-width: 768px) {
    padding-left: 0;
  }
}

.detailItemTitle {
  font-size: $font-size-base;
  font-weight: $font-weight-medium;
  color: var(--color-text-primary);
  margin-bottom: $space-2;
}

.detailItemMeta {
  display: flex;
  flex-direction: column;
  gap: $space-1;
}

.detailMetaRow {
  display: flex;
  align-items: baseline;
  gap: $space-2;
  font-size: $font-size-sm;
  color: var(--color-text-secondary);

  strong {
    color: var(--color-text-primary);
    font-weight: $font-weight-medium;
    min-width: 100px;
  }
}

/* Discount code styling */
.discountCode {
  display: inline-block;
  padding: $space-1 $space-2;
  background: linear-gradient(135deg, rgba(var(--color-primary-rgb), 0.1), rgba(var(--color-primary-rgb), 0.2));
  border: 1px dashed var(--color-primary);
  border-radius: var(--radius-sm);
  font-family: 'SF Mono', Monaco, 'Courier New', monospace;
  font-size: $font-size-sm;
  font-weight: $font-weight-semibold;
  color: var(--color-primary);
  letter-spacing: 0.05em;
}

/* Empty state for details tab - fills available space and centers content */
.detailsEmptyState {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: $space-10;
  text-align: center;
  /* Fill all available space */
  flex: 1 1 0;
  /* Explicit height for Safari */
  height: 100%;
  /* Allow shrinking below content size */
  min-height: 0;
}

.detailsEmptyIcon {
  font-size: 48px;
  margin-bottom: $space-4;
  opacity: 0.6;
}

.detailsEmptyText {
  font-size: $font-size-lg;
  font-weight: $font-weight-medium;
  color: var(--color-text-primary);
  margin-bottom: $space-2;
}

.detailsEmptyHint {
  font-size: $font-size-sm;
  color: var(--color-text-muted);
  max-width: 300px;
}

/* =============================================
   Location Tab Content
   ============================================= */

/* Location Tab Content - Container for location info and map
 * This must fill 100% of available vertical space within detailsContent.
 * Contains: copyableAddressBar (fixed) + locationMapWrapper (fills remaining space)
 */
.locationTabContent {
  /* Flex column container */
  display: flex;
  flex-direction: column;
  /* Fill available space */
  flex: 1 1 0;
  /* Explicit height for Safari */
  height: 100%;
  /* Max height prevents overflow */
  max-height: 100%;
  /* Allow shrinking below content size */
  min-height: 0;
  padding: $space-4 $space-6;
  /* Enable vertical scrolling for mobile when map + address overflow */
  overflow-y: auto;
  /* Prevent horizontal overflow */
  overflow-x: hidden;
  /* Prevent scroll chaining to parent */
  overscroll-behavior: contain;
  /* Smooth scrolling on iOS */
  -webkit-overflow-scrolling: touch;

  @media (max-width: 768px) {
    padding: $space-3 $space-4;
    /* Ensure usable height on mobile */
    min-height: 300px;
  }
}

.locationHeader {
  display: flex;
  align-items: flex-start;
  gap: $space-4;
  padding: $space-4;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border-light);
  margin-bottom: $space-4;
}

.locationIcon {
  width: 48px;
  height: 48px;
  border-radius: var(--radius-full);
  background: rgba(var(--color-primary-rgb), 0.15);
  color: var(--color-primary);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: $font-size-xl;
  flex-shrink: 0;
}

.locationInfo {
  flex: 1;
  min-width: 0;
}

.locationAddress {
  font-size: $font-size-base;
  font-weight: $font-weight-medium;
  color: var(--color-text-primary);
  line-height: 1.4;
  margin-bottom: $space-1;
}

.locationMeta {
  font-size: $font-size-sm;
  color: var(--color-text-muted);
}

.changeLocationButton {
  padding: $space-2 $space-4;
  background: transparent;
  border: 1px solid var(--color-border-medium);
  border-radius: var(--radius-md);
  color: var(--color-text-secondary);
  font-size: $font-size-sm;
  font-weight: $font-weight-medium;
  cursor: pointer;
  flex-shrink: 0;
  @include transition-all($transition-fast);

  &:hover {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
}

/* Map wrapper - fills remaining vertical space after address bar */
.locationMapWrapper {
  /* Fill remaining vertical space */
  flex: 1 1 0;
  /* Minimum height ensures map is usable */
  min-height: 400px;
  /* Allow shrinking on very small screens */
  /* Note: min-height takes precedence over flex shrink */
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--color-border-light);

  @media (max-width: 768px) {
    min-height: 300px;
  }
}

/* Copyable address bar - clickable button to copy full address */
.copyableAddressBar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: $space-3;
  width: 100%;
  padding: $space-3 $space-4;
  margin-bottom: $space-4;
  background: var(--color-bg-tertiary);
  border: 1px dashed var(--color-border-medium);
  border-radius: var(--radius-md);
  cursor: pointer;
  @include transition-all($transition-fast);

  &:hover {
    background: var(--color-bg-secondary);
    border-color: var(--color-primary);
    border-style: solid;
  }

  &:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  &.copied {
    background: rgba(var(--success-rgb, 34, 197, 94), 0.1);
    border-color: var(--color-success, #22c55e);
    border-style: solid;
  }
}

.copyableAddressText {
  flex: 1;
  font-size: $font-size-sm;
  font-family: var(--font-mono, monospace);
  color: var(--color-text-secondary);
  text-align: left;
  word-break: break-word;
  line-height: 1.4;

  .copied & {
    color: var(--color-success, #22c55e);
  }
}

.copyAddressIcon {
  flex-shrink: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--color-bg-secondary);
  border-radius: var(--radius-md);
  color: var(--color-text-muted);
  font-size: $font-size-base;
  @include transition-all($transition-fast);

  .copyableAddressBar:hover & {
    background: var(--color-primary);
    color: white;
  }

  .copied & {
    background: var(--color-success, #22c55e);
    color: white;
  }
}
